'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol ? "symbol" : typeof obj; };

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = createDigestForObject;

var _crypto = require('crypto');

var _crypto2 = _interopRequireDefault(_crypto);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function updateDigestForJsonValue(shasum, value) {
  // Implmentation is similar to that of pretty-printing a JSON object, except:
  // * Strings are not escaped.
  // * No effort is made to avoid trailing commas.
  // These shortcuts should not affect the correctness of this function.
  var type = typeof value === 'undefined' ? 'undefined' : _typeof(value);

  if (type === 'string') {
    shasum.update('"', 'utf8');
    shasum.update(value, 'utf8');
    shasum.update('"', 'utf8');
    return;
  }

  if (type === 'boolean' || type === 'number') {
    shasum.update(value.toString(), 'utf8');
    return;
  }

  if (!value) {
    shasum.update('null', 'utf8');
    return;
  }

  if (Array.isArray(value)) {
    shasum.update('[', 'utf8');
    for (var i = 0; i < value.length; i++) {
      updateDigestForJsonValue(shasum, value[i]);
      shasum.update(',', 'utf8');
    }
    shasum.update(']', 'utf8');
    return;
  }

  // value must be an object: be sure to sort the keys.
  var keys = Object.keys(value);
  keys.sort();

  shasum.update('{', 'utf8');

  for (var i = 0; i < keys.length; i++) {
    updateDigestForJsonValue(shasum, keys[i]);
    shasum.update(': ', 'utf8');
    updateDigestForJsonValue(shasum, value[keys[i]]);
    shasum.update(',', 'utf8');
  }

  shasum.update('}', 'utf8');
}

/**
 * Creates a hash from a JS object
 * 
 * @private  
 */
function createDigestForObject(obj) {
  var sha1 = _crypto2.default.createHash('sha1');
  updateDigestForJsonValue(sha1, obj);

  return sha1.digest('hex');
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9kaWdlc3QtZm9yLW9iamVjdC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7O2tCQTBEd0I7Ozs7Ozs7O0FBeER4QixTQUFTLHdCQUFULENBQWtDLE1BQWxDLEVBQTBDLEtBQTFDLEVBQWlEOzs7OztBQUsvQyxNQUFNLGNBQWMsb0RBQWQsQ0FMeUM7O0FBTy9DLE1BQUksU0FBUyxRQUFULEVBQW1CO0FBQ3JCLFdBQU8sTUFBUCxDQUFjLEdBQWQsRUFBbUIsTUFBbkIsRUFEcUI7QUFFckIsV0FBTyxNQUFQLENBQWMsS0FBZCxFQUFxQixNQUFyQixFQUZxQjtBQUdyQixXQUFPLE1BQVAsQ0FBYyxHQUFkLEVBQW1CLE1BQW5CLEVBSHFCO0FBSXJCLFdBSnFCO0dBQXZCOztBQU9BLE1BQUksU0FBUyxTQUFULElBQXNCLFNBQVMsUUFBVCxFQUFtQjtBQUMzQyxXQUFPLE1BQVAsQ0FBYyxNQUFNLFFBQU4sRUFBZCxFQUFnQyxNQUFoQyxFQUQyQztBQUUzQyxXQUYyQztHQUE3Qzs7QUFLQSxNQUFJLENBQUMsS0FBRCxFQUFRO0FBQ1YsV0FBTyxNQUFQLENBQWMsTUFBZCxFQUFzQixNQUF0QixFQURVO0FBRVYsV0FGVTtHQUFaOztBQUtBLE1BQUksTUFBTSxPQUFOLENBQWMsS0FBZCxDQUFKLEVBQTBCO0FBQ3hCLFdBQU8sTUFBUCxDQUFjLEdBQWQsRUFBbUIsTUFBbkIsRUFEd0I7QUFFeEIsU0FBSyxJQUFJLElBQUUsQ0FBRixFQUFLLElBQUksTUFBTSxNQUFOLEVBQWMsR0FBaEMsRUFBcUM7QUFDbkMsK0JBQXlCLE1BQXpCLEVBQWlDLE1BQU0sQ0FBTixDQUFqQyxFQURtQztBQUVuQyxhQUFPLE1BQVAsQ0FBYyxHQUFkLEVBQW1CLE1BQW5CLEVBRm1DO0tBQXJDO0FBSUEsV0FBTyxNQUFQLENBQWMsR0FBZCxFQUFtQixNQUFuQixFQU53QjtBQU94QixXQVB3QjtHQUExQjs7O0FBeEIrQyxNQW1DM0MsT0FBTyxPQUFPLElBQVAsQ0FBWSxLQUFaLENBQVAsQ0FuQzJDO0FBb0MvQyxPQUFLLElBQUwsR0FwQytDOztBQXNDL0MsU0FBTyxNQUFQLENBQWMsR0FBZCxFQUFtQixNQUFuQixFQXRDK0M7O0FBd0MvQyxPQUFLLElBQUksSUFBRSxDQUFGLEVBQUssSUFBSSxLQUFLLE1BQUwsRUFBYSxHQUEvQixFQUFvQztBQUNsQyw2QkFBeUIsTUFBekIsRUFBaUMsS0FBSyxDQUFMLENBQWpDLEVBRGtDO0FBRWxDLFdBQU8sTUFBUCxDQUFjLElBQWQsRUFBb0IsTUFBcEIsRUFGa0M7QUFHbEMsNkJBQXlCLE1BQXpCLEVBQWlDLE1BQU0sS0FBSyxDQUFMLENBQU4sQ0FBakMsRUFIa0M7QUFJbEMsV0FBTyxNQUFQLENBQWMsR0FBZCxFQUFtQixNQUFuQixFQUprQztHQUFwQzs7QUFPQSxTQUFPLE1BQVAsQ0FBYyxHQUFkLEVBQW1CLE1BQW5CLEVBL0MrQztDQUFqRDs7Ozs7OztBQXdEZSxTQUFTLHFCQUFULENBQStCLEdBQS9CLEVBQW9DO0FBQ2pELE1BQUksT0FBTyxpQkFBTyxVQUFQLENBQWtCLE1BQWxCLENBQVAsQ0FENkM7QUFFakQsMkJBQXlCLElBQXpCLEVBQStCLEdBQS9CLEVBRmlEOztBQUlqRCxTQUFPLEtBQUssTUFBTCxDQUFZLEtBQVosQ0FBUCxDQUppRDtDQUFwQyIsImZpbGUiOiJkaWdlc3QtZm9yLW9iamVjdC5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBjcnlwdG8gZnJvbSAnY3J5cHRvJztcblxuZnVuY3Rpb24gdXBkYXRlRGlnZXN0Rm9ySnNvblZhbHVlKHNoYXN1bSwgdmFsdWUpIHtcbiAgLy8gSW1wbG1lbnRhdGlvbiBpcyBzaW1pbGFyIHRvIHRoYXQgb2YgcHJldHR5LXByaW50aW5nIGEgSlNPTiBvYmplY3QsIGV4Y2VwdDpcbiAgLy8gKiBTdHJpbmdzIGFyZSBub3QgZXNjYXBlZC5cbiAgLy8gKiBObyBlZmZvcnQgaXMgbWFkZSB0byBhdm9pZCB0cmFpbGluZyBjb21tYXMuXG4gIC8vIFRoZXNlIHNob3J0Y3V0cyBzaG91bGQgbm90IGFmZmVjdCB0aGUgY29ycmVjdG5lc3Mgb2YgdGhpcyBmdW5jdGlvbi5cbiAgY29uc3QgdHlwZSA9IHR5cGVvZih2YWx1ZSk7XG5cbiAgaWYgKHR5cGUgPT09ICdzdHJpbmcnKSB7XG4gICAgc2hhc3VtLnVwZGF0ZSgnXCInLCAndXRmOCcpO1xuICAgIHNoYXN1bS51cGRhdGUodmFsdWUsICd1dGY4Jyk7XG4gICAgc2hhc3VtLnVwZGF0ZSgnXCInLCAndXRmOCcpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmICh0eXBlID09PSAnYm9vbGVhbicgfHwgdHlwZSA9PT0gJ251bWJlcicpIHtcbiAgICBzaGFzdW0udXBkYXRlKHZhbHVlLnRvU3RyaW5nKCksICd1dGY4Jyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgaWYgKCF2YWx1ZSkge1xuICAgIHNoYXN1bS51cGRhdGUoJ251bGwnLCAndXRmOCcpO1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuICAgIHNoYXN1bS51cGRhdGUoJ1snLCAndXRmOCcpO1xuICAgIGZvciAobGV0IGk9MDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICB1cGRhdGVEaWdlc3RGb3JKc29uVmFsdWUoc2hhc3VtLCB2YWx1ZVtpXSk7XG4gICAgICBzaGFzdW0udXBkYXRlKCcsJywgJ3V0ZjgnKTtcbiAgICB9XG4gICAgc2hhc3VtLnVwZGF0ZSgnXScsICd1dGY4Jyk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLy8gdmFsdWUgbXVzdCBiZSBhbiBvYmplY3Q6IGJlIHN1cmUgdG8gc29ydCB0aGUga2V5cy5cbiAgbGV0IGtleXMgPSBPYmplY3Qua2V5cyh2YWx1ZSk7XG4gIGtleXMuc29ydCgpO1xuXG4gIHNoYXN1bS51cGRhdGUoJ3snLCAndXRmOCcpO1xuXG4gIGZvciAobGV0IGk9MDsgaSA8IGtleXMubGVuZ3RoOyBpKyspIHtcbiAgICB1cGRhdGVEaWdlc3RGb3JKc29uVmFsdWUoc2hhc3VtLCBrZXlzW2ldKTtcbiAgICBzaGFzdW0udXBkYXRlKCc6ICcsICd1dGY4Jyk7XG4gICAgdXBkYXRlRGlnZXN0Rm9ySnNvblZhbHVlKHNoYXN1bSwgdmFsdWVba2V5c1tpXV0pO1xuICAgIHNoYXN1bS51cGRhdGUoJywnLCAndXRmOCcpO1xuICB9XG5cbiAgc2hhc3VtLnVwZGF0ZSgnfScsICd1dGY4Jyk7XG59XG5cblxuLyoqXG4gKiBDcmVhdGVzIGEgaGFzaCBmcm9tIGEgSlMgb2JqZWN0XG4gKiBcbiAqIEBwcml2YXRlICBcbiAqLyBcbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGNyZWF0ZURpZ2VzdEZvck9iamVjdChvYmopIHtcbiAgbGV0IHNoYTEgPSBjcnlwdG8uY3JlYXRlSGFzaCgnc2hhMScpO1xuICB1cGRhdGVEaWdlc3RGb3JKc29uVmFsdWUoc2hhMSwgb2JqKTtcbiAgXG4gIHJldHVybiBzaGExLmRpZ2VzdCgnaGV4Jyk7XG59XG4iXX0=